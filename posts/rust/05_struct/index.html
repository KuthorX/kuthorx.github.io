<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Rust - Basic - 05 - Struct | KuthorX Blog II</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="RRRRR"><meta name=generator content="Hugo 0.148.2"><meta name=robots content="index, follow"><link rel=stylesheet href=/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css><link rel=stylesheet href=/css/about.css><link rel="shortcut icon" href=/images/KuthorX-512.webp type=image/x-icon><link rel=canonical href=https://kuthorx.github.io/posts/rust/05_struct/><meta property="og:url" content="https://kuthorx.github.io/posts/rust/05_struct/"><meta property="og:site_name" content="KuthorX Blog II"><meta property="og:title" content="Rust - Basic - 05 - Struct"><meta property="og:description" content="RRRRR"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-03T00:00:05+08:00"><meta property="article:modified_time" content="2022-01-03T00:00:05+08:00"><meta itemprop=name content="Rust - Basic - 05 - Struct"><meta itemprop=description content="RRRRR"><meta itemprop=datePublished content="2022-01-03T00:00:05+08:00"><meta itemprop=dateModified content="2022-01-03T00:00:05+08:00"><meta itemprop=wordCount content="617"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust - Basic - 05 - Struct"><meta name=twitter:description content="RRRRR"></head><body class="ma0 avenir bg-near-white production"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l center items-center justify-between"><a href=/ class="f3 fw2 hover-white white-90 dib no-underline">KuthorX Blog II</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/about/ title="About 页">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/posts/ title="Posts 页">Posts</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/repos/ title="Repos 页">Repos</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/story_of_cloak/ title="苍绿之眼-故事线 页">苍绿之眼-故事线</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/character/ title="苍绿之眼-角色卡 页">苍绿之眼-角色卡</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l mw8 center ph3 flex-wrap justify-between"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Rust</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Rust - Basic - 05 - Struct</h1><time class="f6 mv4 dib tracked" datetime=2022-01-03T00:00:05+08:00>一月 3, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id=struct>Struct</h1><h1 id=comprehension>Comprehension</h1><ul><li><p>基础语法</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>// 类型声明
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    active: <span style=color:#66d9ef>bool</span>,
</span></span><span style=display:flex><span>    username: String,
</span></span><span style=display:flex><span>    email: String,
</span></span><span style=display:flex><span>    sign_in_count: <span style=color:#66d9ef>u64</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 实例化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> user1 <span style=color:#f92672>=</span> User {
</span></span><span style=display:flex><span>    email: String::from(<span style=color:#e6db74>&#34;someone@example.com&#34;</span>),
</span></span><span style=display:flex><span>    username: String::from(<span style=color:#e6db74>&#34;someusername123&#34;</span>),
</span></span><span style=display:flex><span>    active: <span style=color:#a6e22e>true</span>,
</span></span><span style=display:flex><span>    sign_in_count: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 访问&amp;修改
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> user1 <span style=color:#f92672>=</span> User {
</span></span><span style=display:flex><span>    email: String::from(<span style=color:#e6db74>&#34;someone@example.com&#34;</span>),
</span></span><span style=display:flex><span>    username: String::from(<span style=color:#e6db74>&#34;someusername123&#34;</span>),
</span></span><span style=display:flex><span>    active: <span style=color:#a6e22e>true</span>,
</span></span><span style=display:flex><span>    sign_in_count: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>user1.email <span style=color:#f92672>=</span> String::from(<span style=color:#e6db74>&#34;anotheremail@example.com&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// field init shorthand
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>build_user</span>(email: String, username: String) -&gt; <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    User {
</span></span><span style=display:flex><span>        email,
</span></span><span style=display:flex><span>        username,
</span></span><span style=display:flex><span>        active: <span style=color:#a6e22e>true</span>,
</span></span><span style=display:flex><span>        sign_in_count: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// struct update
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> user2 <span style=color:#f92672>=</span> User {
</span></span><span style=display:flex><span>    email: String::from(<span style=color:#e6db74>&#34;another@example.com&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>user1
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 这里 user1 move 了，因为 user1.username (String 类型) 被 move 为 user2.username
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 如果初始化 user2 的时候另外赋值 username，则 user1 不会被 move
</span></span></span></code></pre></div></li><li><p>Method</p><p>struct impl 内的 function 称为 method 或者 associated function，method 与 field 可以同名</p><p>可同时存在多个 impl</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[derive(Debug)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Rectangle</span> {
</span></span><span style=display:flex><span>    width: <span style=color:#66d9ef>u32</span>,
</span></span><span style=display:flex><span>    height: <span style=color:#66d9ef>u32</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Rectangle {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>area</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>u32</span> {  <span style=color:#75715e>// method
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        self.width <span style=color:#f92672>*</span> self.height
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>width</span>(<span style=color:#f92672>&amp;</span>self) -&gt; <span style=color:#66d9ef>bool</span> {  <span style=color:#75715e>// method 与 field 可以同名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        self.width <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>square</span>(size: <span style=color:#66d9ef>u32</span>) -&gt; <span style=color:#a6e22e>Rectangle</span> {  <span style=color:#75715e>// 不带 &amp;self 也可以
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Rectangle {
</span></span><span style=display:flex><span>            width: <span style=color:#a6e22e>size</span>,
</span></span><span style=display:flex><span>            height: <span style=color:#a6e22e>size</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 可同时存在多个 impl
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>impl</span> Rectangle {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>can_hold</span>(<span style=color:#f92672>&amp;</span>self, other: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>Rectangle</span>) -&gt; <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        self.width <span style=color:#f92672>&gt;</span> other.width <span style=color:#f92672>&amp;&amp;</span> self.height <span style=color:#f92672>&gt;</span> other.height
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> rect1 <span style=color:#f92672>=</span> Rectangle {
</span></span><span style=display:flex><span>        width: <span style=color:#ae81ff>30</span>,
</span></span><span style=display:flex><span>        height: <span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;The area of the rectangle is </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> square pixels.&#34;</span>,
</span></span><span style=display:flex><span>        rect1.area()
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> rect1.width() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;The rectangle has a nonzero width; it is </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, rect1.width);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ul><h1 id=origin>Origin</h1><blockquote><p><a href=https://doc.rust-lang.org/book/ch05-00-structs.html>https://doc.rust-lang.org/book/ch05-00-structs.html</a></p></blockquote><p>&mldr;</p><h3 id=creating-instances-from-other-instances-with-struct-update-syntax><a href=https://doc.rust-lang.org/book/ch05-01-defining-structs.html#creating-instances-from-other-instances-with-struct-update-syntax>Creating Instances From Other Instances With Struct Update Syntax</a></h3><p>It’s often useful to create a new instance of a struct that uses most of an old instance’s values but changes some. You can do this using <em>struct update syntax</em>.</p><p>First, Listing 5-6 shows how we create a new <code>User</code> instance in <code>user2</code> without the update syntax. We set a new value for <code>email</code> but otherwise use the same values from <code>user1</code> that we created in Listing 5-2.</p><pre tabindex=0><code>
    let user2 = User {
        active: user1.active,
        username: user1.username,
        email: String::from(&#34;another@example.com&#34;),
        sign_in_count: user1.sign_in_count,
    };
</code></pre><p><strong>Listing 5-6: Creating a new <code>User</code> instance using one of the values from <code>user1</code></strong></p><p>Using struct update syntax, we can achieve the same effect with less code, as shown in Listing 5-7. The syntax <code>..</code> specifies that the remaining fields not explicitly set should have the same value as the fields in the given instance.</p><pre tabindex=0><code>
    let user2 = User {
        email: String::from(&#34;another@example.com&#34;),
        ..user1
    };
</code></pre><p><strong>Listing 5-7: Using struct update syntax to set a new <code>email</code> value for a <code>User</code> instance but use the rest of the values from <code>user1</code></strong></p><p>The code in Listing 5-7 also creates an instance in <code>user2</code> that has a different value for <code>email</code> but has the same values for the <code>username</code>, <code>active</code>, and <code>sign_in_count</code> fields from <code>user1</code>. The <code>..user1</code> must come last to specify that any remaining fields should get their values from the corresponding fields in <code>user1</code>, but we can choose to specify values for as many fields as we want in any order, regardless of the order of the fields in the struct’s definition.</p><p>Note that the struct update syntax is like assignment with <code>=</code> because it moves the data, just as we saw in the <a href=https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html#ways-variables-and-data-interact-move>“Ways Variables and Data Interact: Move” section</a>. In this example, we can no longer use <code>user1</code> after creating <code>user2</code> because the <code>String</code> in the <code>username</code> field of <code>user1</code> was moved into <code>user2</code>. If we had given <code>user2</code> new <code>String</code> values for both <code>email</code> and <code>username</code>, and thus only used the <code>active</code> and <code>sign_in_count</code> values from <code>user1</code>, then <code>user1</code> would still be valid after creating <code>user2</code>. The types of <code>active</code> and <code>sign_in_count</code> are types that implement the <code>Copy</code> trait, so the behavior we discussed in the <a href=https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html#stack-only-data-copy>“Stack-Only Data: Copy” section</a> would apply.</p><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href=https://kuthorx.github.io/>&copy; KuthorX Blog II 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>
<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Rust - Basic - 01 - Variables shadowing | KuthorX Blog II</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="R"><meta name=generator content="Hugo 0.148.2"><meta name=robots content="index, follow"><link rel=stylesheet href=/ananke/css/main.min.8d048772ae72ab11245a0e296d1f2a36d3e3dd376c6c867394d6cc659c68fc37.css><link rel=stylesheet href=/css/about.css><link rel="shortcut icon" href=/images/KuthorX-512.webp type=image/x-icon><link rel=canonical href=https://kuthorx.github.io/posts/rust/01_variables-shadowing/><meta property="og:url" content="https://kuthorx.github.io/posts/rust/01_variables-shadowing/"><meta property="og:site_name" content="KuthorX Blog II"><meta property="og:title" content="Rust - Basic - 01 - Variables shadowing"><meta property="og:description" content="R"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-03T00:00:01+08:00"><meta property="article:modified_time" content="2022-01-03T00:00:01+08:00"><meta itemprop=name content="Rust - Basic - 01 - Variables shadowing"><meta itemprop=description content="R"><meta itemprop=datePublished content="2022-01-03T00:00:01+08:00"><meta itemprop=dateModified content="2022-01-03T00:00:01+08:00"><meta itemprop=wordCount content="457"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust - Basic - 01 - Variables shadowing"><meta name=twitter:description content="R"></head><body class="ma0 avenir bg-near-white production"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l center items-center justify-between"><a href=/ class="f3 fw2 hover-white white-90 dib no-underline">KuthorX Blog II</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/about/ title="About 页">About</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/posts/ title="Posts 页">Posts</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/repos/ title="Repos 页">Repos</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white white-90 no-underline" href=/story_of_cloak/ title="苍绿之眼-故事线 页">苍绿之眼-故事线</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l mw8 center ph3 flex-wrap justify-between"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Rust</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Rust - Basic - 01 - Variables shadowing</h1><time class="f6 mv4 dib tracked" datetime=2022-01-03T00:00:01+08:00>一月 3, 2022</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id=variables-shadowing>Variables shadowing</h1><h1 id=comprehension>Comprehension</h1><p>在 Rust 中，如果一个变量（ <code>let</code> 或者 <code>let mut</code> ） <code>a</code> 在后续中重复声明，那么这种行为被称为 shadowing 。</p><ul><li><code>const</code> 常量无法 shadowing</li><li>shadowing 可以有块（ <code>{}</code> ）作用域</li><li>shadowing 可以在变量名相同的基础上，同时声明新的数据类型</li></ul><h1 id=origin>Origin</h1><blockquote><p><a href=https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html#shadowing>https://doc.rust-lang.org/book/ch03-01-variables-and-mutability.html#shadowing</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> x <span style=color:#f92672>=</span> x <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> x <span style=color:#f92672>=</span> x <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;The value of x in the inner scope is: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, x);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;The value of x is: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, x);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This program first binds <code>x</code> to a value of <code>5</code>. Then it shadows <code>x</code> by repeating <code>let x =</code>, taking the original value and adding <code>1</code> so the value of <code>x</code> is then <code>6</code>. Then, within an inner scope, the third <code>let</code> statement also shadows <code>x</code>, multiplying the previous value by <code>2</code> to give <code>x</code> a value of <code>12</code>. When that scope is over, the inner shadowing ends and <code>x</code> returns to being <code>6</code>. When we run this program, it will output the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>$</span> cargo run
</span></span><span style=display:flex><span>   Compiling variables v0.<span style=color:#ae81ff>1.0</span> (file:<span style=color:#e6db74>///projects/variables)
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>    Finished dev [unoptimized <span style=color:#f92672>+</span> debuginfo] target(s) <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0.31</span>s
</span></span><span style=display:flex><span>     Running <span style=color:#960050;background-color:#1e0010>`</span>target<span style=color:#f92672>/</span>debug<span style=color:#f92672>/</span>variables<span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>The value of x <span style=color:#66d9ef>in</span> the inner scope is: <span style=color:#ae81ff>12</span>
</span></span><span style=display:flex><span>The value of x is: <span style=color:#ae81ff>6</span>
</span></span></code></pre></div><p>Shadowing is different from marking a variable as <code>mut</code>, because we’ll get a compile-time error if we accidentally try to reassign to this variable without using the <code>let</code> keyword. By using <code>let</code>, we can perform a few transformations on a value but have the variable be immutable after those transformations have been completed.</p><p>The other difference between <code>mut</code> and shadowing is that because we’re effectively creating a new variable when we use the <code>let</code> keyword again, we can change the type of the value but reuse the same name. For example, say our program asks a user to show how many spaces they want between some text by inputting space characters, but we really want to store that input as a number:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> spaces <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;   &#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> spaces <span style=color:#f92672>=</span> spaces.len();
</span></span></code></pre></div><p>This construct is allowed because the first <code>spaces</code> variable is a string type and the second <code>spaces</code> variable, which is a brand-new variable that happens to have the same name as the first one, is a number type. Shadowing thus spares us from having to come up with different names, such as <code>spaces_str</code> and <code>spaces_num</code>; instead, we can reuse the simpler <code>spaces</code> name. However, if we try to use <code>mut</code> for this, as shown here, we’ll get a compile-time error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> spaces <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;   &#34;</span>;
</span></span><span style=display:flex><span>    spaces <span style=color:#f92672>=</span> spaces.len();
</span></span></code></pre></div><p>The error says we’re not allowed to mutate a variable’s type:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>$</span> cargo run
</span></span><span style=display:flex><span>   Compiling variables v0.<span style=color:#ae81ff>1.0</span> (file:<span style=color:#e6db74>///projects/variables)
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>error[E0308]: <span style=color:#a6e22e>mismatched</span> types
</span></span><span style=display:flex><span> <span style=color:#f92672>-</span>-&gt; <span style=color:#a6e22e>src</span><span style=color:#f92672>/</span>main.rs:<span style=color:#ae81ff>3</span>:<span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span>     spaces <span style=color:#f92672>=</span> spaces.len();
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span>              <span style=color:#f92672>^^^^^^^^^^^^</span> expected <span style=color:#960050;background-color:#1e0010>`</span><span style=color:#f92672>&amp;</span><span style=color:#66d9ef>str</span><span style=color:#960050;background-color:#1e0010>`</span>, found <span style=color:#960050;background-color:#1e0010>`</span><span style=color:#66d9ef>usize</span><span style=color:#960050;background-color:#1e0010>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For more information about this error, <span style=color:#66d9ef>try</span> <span style=color:#960050;background-color:#1e0010>`</span>rustc <span style=color:#f92672>--</span>explain E0308<span style=color:#960050;background-color:#1e0010>`</span>.
</span></span><span style=display:flex><span>error: <span style=color:#a6e22e>could</span> not compile <span style=color:#960050;background-color:#1e0010>`</span>variables<span style=color:#960050;background-color:#1e0010>`</span> due to previous error
</span></span></code></pre></div><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href=https://kuthorx.github.io/>&copy; KuthorX Blog II 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>